// Greasemonkey 4 polyfils
// src: https://greasemonkey.github.io/gm4-polyfill/gm4-polyfill.js
// see: https://www.greasespot.net/2017/09/greasemonkey-4-for-script-authors.html
"undefined"==typeof GM&&(this.GM={}),"undefined"==typeof GM_addStyle&&(this.GM_addStyle=(e=>{"use strict";let t=document.getElementsByTagName("head")[0];if(t){let n=document.createElement("style");return n.setAttribute("type","text/css"),n.textContent=e,t.appendChild(n),n}return null})),"undefined"==typeof GM_registerMenuCommand&&(this.GM_registerMenuCommand=((e,t,n)=>{if(!document.body)return void("loading"===document.readyState&&document.documentElement&&"html"===document.documentElement.localName?new MutationObserver((o,u)=>{document.body&&(u.disconnect(),GM_registerMenuCommand(e,t,n))}).observe(document.documentElement,{childList:!0}):console.error("GM_registerMenuCommand got no body."));let o=document.body.getAttribute("contextmenu"),u=o?document.querySelector("menu#"+o):null;u||((u=document.createElement("menu")).setAttribute("id","gm-registered-menu"),u.setAttribute("type","context"),document.body.appendChild(u),document.body.setAttribute("contextmenu","gm-registered-menu"));let d=document.createElement("menuitem");d.textContent=e,d.addEventListener("click",t,!0),u.appendChild(d)})),"undefined"==typeof GM_getResourceText&&(this.GM_getResourceText=(e=>{"use strict";return GM.getResourceUrl(e).then(e=>fetch(e)).then(e=>e.text()).catch(function(e){return GM.log("Request failed",e),null})})),Object.entries({log:console.log.bind(console),info:GM_info}).forEach(([e,t])=>{t&&void 0===GM[e]&&(GM[e]=t)}),Object.entries({GM_addStyle:"addStyle",GM_deleteValue:"deleteValue",GM_getResourceURL:"getResourceUrl",GM_getValue:"getValue",GM_listValues:"listValues",GM_notification:"notification",GM_openInTab:"openInTab",GM_registerMenuCommand:"registerMenuCommand",GM_setClipboard:"setClipboard",GM_setValue:"setValue",GM_xmlhttpRequest:"xmlHttpRequest",GM_getResourceText:"getResourceText"}).forEach(([e,t])=>{let n=this[e];n&&void 0===GM[t]&&(GM[t]=function(...e){return new Promise((t,o)=>{try{t(n.apply(this,e))}catch(e){o(e)}})})});
